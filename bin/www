// Environment settings
require('dotenv').config();

// Import modules
const http = require('http');

const app = require('../app');
const MongoDriver = require('../libs/MongoDriver');
const winstonInfo = require('../libs/LogUtil').winstonInfo;

// Routes
require('../routes/indexRoute');
require('../routes/subscribeRoute');
require('../routes/accessTokenRoute');
require('../routes/instaApiRoute');
require('../routes/slackApiRoute');
require('../routes/botRoute');
require('../routes/errorRoute');

// Set MongoDriver as locals in app
app.locals.mongoDriver = MongoDriver;
app.locals.mongoDriver.openDBConnection().then(() => {
  // Server and Port
  const server = new http.Server(app);
  const portApp = (process.env.PORT) || 3001;

  server.listen(portApp, () => {
    winstonInfo(`Listening on port ${portApp}!`);
  });
});
